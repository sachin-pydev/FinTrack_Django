{% extends "base.html" %}
{% load static %}
{% block title %}Dashboard - FinTrack{% endblock %}
{% block style %}
<link rel="stylesheet" href="{% static 'dashboard/style/dashboard.css' %}">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

<body>
{% block content %}
<div class="container-fluid p-3">
  <h2 class="mb-4 text-center">Dashboard Overview</h2>

  <!-- Summary Cards -->
  <section class="cards d-flex flex-wrap justify-content-center gap-3 mb-4">
    <div class="card p-3 text-center">
      <h5><b>Average Daily Expense</b></h5>
      <div class="value">₹{{ avg_daily_expense|floatformat:2 }}</div>
    </div>
    <div class="card p-3 text-center">
      <h5><b>Total Income</b></h5>
      <div class="value text-success">+₹{{ total_income|floatformat:2 }}</div>
    </div>
    <div class="card p-3 text-center">
      <h5><b>Total Expenses</b></h5>
      <div class="value text-danger">-₹{{ total_expenses|floatformat:2 }}</div>
    </div>
    <div class="card p-3 text-center">
      <h5><b>Total Balance</b></h5>
      <div class="value" style="color:var(--budget);">₹{{ total_balance|floatformat:2 }}</div>
    </div>
  </section>

  <!-- Charts -->
  <div class="row justify-content-center mb-5">
    <div class="col-md-5 mb-3">
      <div class="chart-card p-3">
        <h5 class="text-center mb-3">Expense vs Income</h5>
        <canvas id="expenseIncomeChart"></canvas>
      </div>
    </div>
    <div class="col-md-5 mb-3">
      <div class="chart-card p-3">
        <h5 class="text-center mb-3">Category Breakdown</h5>
        <canvas id="categoryChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Recent Transactions -->
  <section class="Recent-expenses mb-4">
    <h4>Recent Transactions</h4>
    <p> {{ recent_5_records|length }} transactions in history</p>
    <div class="table-container">
      <table class="table table-striped table-bordered text-center">
        <thead>
          <tr>
            <th>#</th>
            <th>Date</th>
            <th>Type</th>
            <th>Category</th>
            <th>Description</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody>
          {% for t in recent_5_records %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ t.date }}</td>
            <td>{{ t.type }}</td>
            <td>{{ t.category }}</td>
            <td>{{ t.description|default:"-" }}</td>
            <td>
              {% if t.type == 'Income' %}
              <span class="text-success">+₹{{ t.amount|floatformat:2 }}</span>
              {% else %}
              <span class="text-danger">-₹{{ t.amount|floatformat:2 }}</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-muted py-3">No transactions yet.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</div>

<!-- Chart JS -->
<script>
const ctx1 = document.getElementById('expenseIncomeChart').getContext('2d');
new Chart(ctx1, {
  type: 'doughnut',
  data: {
    labels: ['Expenses', 'Income'],
    datasets: [{
      data: [{{ total_expenses|default:0 }}, {{ total_income|default:0 }}],
      backgroundColor: ['#d62828', '#2a9d8f'],
      borderWidth: 0
    }]
  },
  options: {
    plugins: {
      legend: { position: 'bottom' }
    }
  }
});

const ctx2 = document.getElementById('categoryChart').getContext('2d');
new Chart(ctx2, {
  type: 'bar',
  data: {
    labels: {{ category_labels|safe }},
    datasets: [{
      label: 'Expenses by Category',
      data: {{ category_values|safe }},
      backgroundColor: '#005f73'
    }]
  },
  options: {
    plugins: { legend: { display: false } },
    scales: { y: { beginAtZero: true } }
  }
});
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{% endblock %}
</body>